<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Let's Bet For Life!</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background-color: #f0f2f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Welcome Screen */
        #welcome-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            text-align: center;
        }
        
        #welcome-screen h1 {
            font-size: 2.5rem;
            margin-bottom: 2rem;
            color: #2c3e50;
        }
        
        #start-button {
            padding: 15px 30px;
            font-size: 1.2rem;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        #start-button:hover {
            background-color: #2980b9;
        }
        
        /* Registration Screen */
        #registration-screen {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            text-align: center;
        }
        
        #registration-screen h2 {
            font-size: 2rem;
            margin-bottom: 1.5rem;
            color: #2c3e50;
        }
        
        #registration-form {
            width: 100%;
            max-width: 400px;
        }
        
        #name-input {
            width: 100%;
            padding: 12px;
            margin-bottom: 1rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        #register-button {
            width: 100%;
            padding: 12px;
            background-color: #2ecc71;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
        }
        
        #register-button:hover {
            background-color: #27ae60;
        }
        
        /* Betting Screen */
        #betting-screen {
            display: none;
            padding: 20px;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #ddd;
        }
        
        .user-info {
            display: flex;
            align-items: center;
        }
        
        .username {
            font-size: 1.2rem;
            font-weight: bold;
            margin-right: 20px;
        }
        
        .chip-counter {
            background-color: #f39c12;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
        }
        
        .betting-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 2rem;
        }
        
        .betting-option {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .option-header {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 1rem;
            color: #2c3e50;
        }
        
        .bet-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
        }
        
        .chip-input {
            width: 70%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .place-bet-button {
            padding: 8px 15px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .place-bet-button:hover {
            background-color: #2980b9;
        }
        
        .bet-history {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .history-header {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 1rem;
            color: #2c3e50;
        }
        
        .history-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .history-item {
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        .result-win {
            color: #2ecc71;
            font-weight: bold;
        }
        
        .result-lose {
            color: #e74c3c;
            font-weight: bold;
        }
        
        /* Admin Panel */
        #admin-control {
            display: none;
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #34495e;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            z-index: 1000;
            cursor: pointer;
        }
        
        #admin-panel {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            max-width: 600px;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            z-index: 1001;
        }
        
        .admin-header {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #ddd;
        }
        
        .admin-controls {
            margin-bottom: 1rem;
        }
        
        .admin-controls button {
            padding: 8px 15px;
            margin-right: 10px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .user-list {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 1rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
        }
        
        .user-item {
            padding: 8px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
        }
        
        .close-admin {
            padding: 8px 15px;
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        @media (max-width: 768px) {
            .betting-options {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .user-info {
                margin-bottom: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Welcome Screen -->
    <div id="welcome-screen" class="container">
        <h1>歡迎來到投注網站</h1>
        <button id="start-button">開始投注</button>
    </div>
    
    <!-- Registration Screen -->
    <div id="registration-screen" class="container">
        <h2>請填寫您的名稱</h2>
        <form id="registration-form">
            <input type="text" id="name-input" placeholder="輸入您的名稱" required>
            <button type="submit" id="register-button">登記</button>
        </form>
    </div>
    
    <!-- Betting Screen -->
    <div id="betting-screen" class="container">
        <div class="header">
            <div class="user-info">
                <div class="username" id="display-username">用戶名稱</div>
                <div class="chip-counter">
                    籌碼: <span id="chip-count">1000</span>
                </div>
            </div>
            <div id="game-status">
                遊戲進行中...
            </div>
        </div>
        
        <div class="betting-options">
            <div class="betting-option">
                <div class="option-header">選項 A</div>
                <p>獎金倍率: 1.5x</p>
                <div class="bet-controls">
                    <input type="number" class="chip-input" min="1" placeholder="投注籌碼">
                    <button class="place-bet-button" data-option="A" data-multiplier="1.5">投注</button>
                </div>
            </div>
            
            <div class="betting-option">
                <div class="option-header">選項 B</div>
                <p>獎金倍率: 2x</p>
                <div class="bet-controls">
                    <input type="number" class="chip-input" min="1" placeholder="投注籌碼">
                    <button class="place-bet-button" data-option="B" data-multiplier="2">投注</button>
                </div>
            </div>
            
            <div class="betting-option">
                <div class="option-header">選項 C</div>
                <p>獎金倍率: 3x</p>
                <div class="bet-controls">
                    <input type="number" class="chip-input" min="1" placeholder="投注籌碼">
                    <button class="place-bet-button" data-option="C" data-multiplier="3">投注</button>
                </div>
            </div>
            
            <div class="betting-option">
                <div class="option-header">選項 D</div>
                <p>獎金倍率: 5x</p>
                <div class="bet-controls">
                    <input type="number" class="chip-input" min="1" placeholder="投注籌碼">
                    <button class="place-bet-button" data-option="D" data-multiplier="5">投注</button>
                </div>
            </div>
        </div>
        
        <div class="bet-history">
            <div class="history-header">投注歷史</div>
            <div class="history-list" id="history-list">
                <!-- History items will be added here dynamically -->
            </div>
        </div>
    </div>
    
    <!-- Admin Control -->
    <div id="admin-control">管理員</div>
    
    <!-- Admin Panel -->
    <div id="admin-panel">
        <div class="admin-header">管理員面板</div>
        <div class="admin-controls">
            <button id="reset-all-button">重置所有用戶</button>
            <button id="export-data-button">匯出數據</button>
        </div>
        <div class="user-list" id="user-list">
            <!-- User items will be added here dynamically -->
        </div>
        <button class="close-admin" id="close-admin-button">關閉</button>
    </div>
    
    <script>
        // In-memory database (no localStorage)
        class Database {
            constructor() {
                this.users = {};
                this.currentUser = null;
            }
            
            saveUser(username, chips = 1000) {
                if (!this.users[username]) {
                    this.users[username] = {
                        chips: chips,
                        history: []
                    };
                }
                return this.users[username];
            }
            
            updateChips(username, amount) {
                if (this.users[username]) {
                    this.users[username].chips += amount;
                    return this.users[username].chips;
                }
                return 0;
            }
            
            addBetHistory(username, option, amount, multiplier, result) {
                if (this.users[username]) {
                    this.users[username].history.unshift({
                        option,
                        amount,
                        multiplier,
                        result,
                        timestamp: new Date().toISOString()
                    });
                    
                    // Limit history to 100 items
                    if (this.users[username].history.length > 100) {
                        this.users[username].history.pop();
                    }
                }
            }
            
            getAllUsers() {
                return this.users;
            }
            
            resetAllUsers() {
                this.users = {};
            }
        }
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            const db = new Database();
            let currentUser = null;
            
            // Elements
            const welcomeScreen = document.getElementById('welcome-screen');
            const registrationScreen = document.getElementById('registration-screen');
            const bettingScreen = document.getElementById('betting-screen');
            const startButton = document.getElementById('start-button');
            const registrationForm = document.getElementById('registration-form');
            const nameInput = document.getElementById('name-input');
            const displayUsername = document.getElementById('display-username');
            const chipCount = document.getElementById('chip-count');
            const historyList = document.getElementById('history-list');
            const adminControl = document.getElementById('admin-control');
            const adminPanel = document.getElementById('admin-panel');
            const userList = document.getElementById('user-list');
            const resetAllButton = document.getElementById('reset-all-button');
            const exportDataButton = document.getElementById('export-data-button');
            const closeAdminButton = document.getElementById('close-admin-button');
            
            // Show registration screen
            startButton.addEventListener('click', function() {
                welcomeScreen.style.display = 'none';
                registrationScreen.style.display = 'flex';
            });
            
            // Handle registration
            registrationForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const username = nameInput.value.trim();
                
                if (username) {
                    currentUser = username;
                    const user = db.saveUser(username);
                    
                    // Update UI
                    displayUsername.textContent = username;
                    chipCount.textContent = user.chips;
                    
                    // Show betting screen
                    registrationScreen.style.display = 'none';
                    bettingScreen.style.display = 'block';
                    adminControl.style.display = 'block';
                    
                    // Load user history
                    updateHistoryList();
                }
            });
            
            // Place bet buttons
            const placeBetButtons = document.querySelectorAll('.place-bet-button');
            placeBetButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const option = this.getAttribute('data-option');
                    const multiplier = parseFloat(this.getAttribute('data-multiplier'));
                    const chipInput = this.parentElement.querySelector('.chip-input');
                    const betAmount = parseInt(chipInput.value);
                    
                    if (betAmount && betAmount > 0) {
                        placeBet(currentUser, option, betAmount, multiplier);
                        chipInput.value = ''; // Clear input
                    }
                });
            });
            
            // Place bet function
            function placeBet(username, option, amount, multiplier) {
                // Check if user has enough chips
                const user = db.users[username];
                if (!user || user.chips < amount) {
                    alert('籌碼不足!');
                    return;
                }
                
                // Deduct bet amount
                db.updateChips(username, -amount);
                
                // Determine win or lose (50% chance)
                const isWin = Math.random() >= 0.5;
                let winAmount = 0;
                
                if (isWin) {
                    winAmount = Math.floor(amount * multiplier);
                    db.updateChips(username, winAmount);
                }
                
                // Update history
                db.addBetHistory(
                    username, 
                    option, 
                    amount, 
                    multiplier, 
                    isWin ? 'win' : 'lose'
                );
                
                // Update UI
                chipCount.textContent = db.users[username].chips;
                updateHistoryList();
            }
            
            // Update history list
            function updateHistoryList() {
                if (!currentUser || !db.users[currentUser]) return;
                
                const history = db.users[currentUser].history;
                historyList.innerHTML = '';
                
                history.forEach(bet => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    
                    const resultClass = bet.result === 'win' ? 'result-win' : 'result-lose';
                    const resultText = bet.result === 'win' ? '勝利' : '失敗';
                    const amountChange = bet.result === 'win' 
                        ? `+${Math.floor(bet.amount * bet.multiplier)}` 
                        : `-${bet.amount}`;
                    
                    historyItem.innerHTML = `
                        <span>選項 ${bet.option} (${bet.multiplier}x): ${bet.amount} 籌碼</span>
                        <span class="${resultClass}">${resultText} ${amountChange}</span>
                    `;
                    
                    historyList.appendChild(historyItem);
                });
            }
            
            // Admin panel
            adminControl.addEventListener('click', function() {
                adminPanel.style.display = 'block';
                updateUserList();
            });
            
            closeAdminButton.addEventListener('click', function() {
                adminPanel.style.display = 'none';
            });
            
            resetAllButton.addEventListener('click', function() {
                if (confirm('確定要重置所有用戶數據嗎?')) {
                    db.resetAllUsers();
                    updateUserList();
                    alert('所有用戶數據已重置');
                }
            });
            
            exportDataButton.addEventListener('click', function() {
                const data = JSON.stringify(db.getAllUsers(), null, 2);
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'betting_data.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            });
            
            function updateUserList() {
                userList.innerHTML = '';
                const users = db.getAllUsers();
                
                Object.entries(users).forEach(([username, data]) => {
                    const userItem = document.createElement('div');
                    userItem.className = 'user-item';
                    userItem.innerHTML = `
                        <span>${username}</span>
                        <span>籌碼: ${data.chips}</span>
                    `;
                    userList.appendChild(userItem);
                });
            }
            
            // Secret admin access (press 'a' key 3 times)
            let keyPressCount = 0;
            document.addEventListener('keydown', function(e) {
                if (e.key === 'a' || e.key === 'A') {
                    keyPressCount++;
                    if (keyPressCount >= 3) {
                        adminControl.style.display = 'block';
                        keyPressCount = 0;
                    }
                } else {
                    keyPressCount = 0;
                }
            });
        });
    </script>
</body>
</html>
